<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat P2P - Made By: @085_Teuzinnn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --main-color: #f97316; --main-glow: rgba(249, 115, 22, 0.4); }
        body { background-color: #0b0f1a; color: #e2e8f0; overflow: hidden; height: 100vh; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .dynamic-border { border: 1px solid var(--main-color) !important; }
        .dynamic-text { color: var(--main-color) !important; }
        .dynamic-bg { background-color: var(--main-color) !important; }
        .dynamic-shadow { box-shadow: 0 0 15px var(--main-glow); }
        #chat-messages { word-wrap: break-word; overflow-wrap: break-word; }
        .msg-bubble { max-width: 85%; word-break: break-word; }
        #chat-messages::-webkit-scrollbar { width: 4px; }
        #chat-messages::-webkit-scrollbar-thumb { background: var(--main-color); border-radius: 10px; }
        .modal-bg { background: rgba(0,0,0,0.8); transition: all 0.3s; }
    </style>
</head>
<body class="flex flex-col font-sans">

    <div class="flex justify-between items-center p-4 bg-slate-900/80 border-b border-white/5">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full dynamic-bg animate-pulse"></div>
            <span class="font-black tracking-tighter dynamic-text uppercase">P2P Secure Chat</span>
        </div>
        <div class="flex gap-3">
            <button onclick="toggleModal('config-modal')" class="hover:scale-110 transition">‚öôÔ∏è</button>
            <button id="fullscreen-btn" class="bg-slate-800 text-white w-8 h-8 rounded-full flex items-center justify-center text-xs dynamic-border transition active:scale-90">üì∫</button>
        </div>
    </div>

    <main class="flex-grow flex flex-col items-center justify-center w-full max-w-lg mx-auto p-4 overflow-hidden">
        
        <div id="setup-screen" class="w-full space-y-4 glass p-8 rounded-3xl animate__animated animate__fadeInUp dynamic-shadow">
            <div class="space-y-3">
                <input type="text" id="username" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 focus:outline-none dynamic-border transition-all text-white" placeholder="Seu apelido">
                <input type="text" id="room-name" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 focus:outline-none dynamic-border transition-all text-white" placeholder="Nome da sala">
                <input type="password" id="room-pass" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 focus:outline-none dynamic-border transition-all text-white" placeholder="Senha da sala (Opcional)">
            </div>
            <div class="grid grid-cols-2 gap-4 pt-2">
                <button onclick="initPeer(true)" class="dynamic-bg text-white font-black py-4 rounded-2xl dynamic-border transition-all active:scale-95">CRIAR</button>
                <button onclick="initPeer(false)" class="bg-transparent dynamic-text font-black py-4 rounded-2xl dynamic-border transition-all active:scale-95">ENTRAR</button>
            </div>
        </div>

        <div id="chat-screen" class="hidden w-full flex-col h-full max-h-[85vh] glass rounded-3xl overflow-hidden animate__animated animate__zoomIn dynamic-shadow">
            <div class="bg-slate-800/80 p-4 border-b border-white/5 flex justify-between items-center">
                <p id="display-room" class="font-bold dynamic-text text-xs uppercase tracking-widest"></p>
                <button onclick="clearChat()" class="text-[10px] bg-slate-700 px-2 py-1 rounded dynamic-border">LIMPAR</button>
            </div>
            
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 flex flex-col"></div>

            <div class="p-4 bg-slate-900/80 border-t border-white/5 space-y-2">
                <div class="flex gap-2">
                    <label class="cursor-pointer bg-slate-800 w-12 h-12 rounded-2xl flex items-center justify-center dynamic-border hover:bg-slate-700 transition">
                        <span>üìé</span>
                        <input type="file" id="file-input" class="hidden" onchange="sendFile(this)">
                    </label>
                    <input type="text" id="message-input" autocomplete="off" class="flex-grow bg-slate-950 border border-slate-800 rounded-2xl px-4 py-3 focus:outline-none dynamic-border transition-all text-sm" placeholder="Mensagem...">
                    <button onclick="sendMessage()" class="dynamic-bg w-12 h-12 rounded-2xl flex items-center justify-center transition-all active:scale-90 dynamic-border">
                        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div id="config-modal" class="fixed inset-0 modal-bg hidden z-50 flex items-center justify-center p-6">
        <div class="bg-slate-800 w-full max-w-xs rounded-3xl p-6 space-y-6 dynamic-border">
            <h3 class="font-bold text-center">Configura√ß√µes</h3>
            <div class="space-y-3">
                <p class="text-xs text-gray-400">Cor do Tema:</p>
                <div class="flex justify-around">
                    <button onclick="setTheme('#f97316')" class="w-8 h-8 rounded-full bg-orange-500 border-2 border-white"></button>
                    <button onclick="setTheme('#22c55e')" class="w-8 h-8 rounded-full bg-green-500"></button>
                    <button onclick="setTheme('#ec4899')" class="w-8 h-8 rounded-full bg-pink-500"></button>
                    <button onclick="setTheme('#a855f7')" class="w-8 h-8 rounded-full bg-purple-500"></button>
                </div>
            </div>
            <button onclick="clearData()" class="w-full py-3 bg-red-600/20 text-red-500 border border-red-600/50 rounded-xl font-bold text-sm">Limpar Dados</button>
            <button onclick="toggleModal('config-modal')" class="w-full py-2 bg-slate-700 rounded-xl text-xs">Fechar</button>
        </div>
    </div>

    <footer class="text-center mt-5 text-gray-500 text-sm">
        Made By: <a href="https://instagram.com/085_Teuzinnn" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold transition duration-200">@085_Teuzinnn</a>
    </footer>

    <script>
        let peer = null, connections = [], myNick = "", roomPass = "";
        const msgContainer = document.getElementById('chat-messages');

        window.onload = () => {
            document.getElementById('username').value = localStorage.getItem('p2p_nick') || '';
            document.getElementById('room-name').value = localStorage.getItem('p2p_room') || '';
            document.getElementById('room-pass').value = localStorage.getItem('p2p_pass') || '';
            const savedColor = localStorage.getItem('p2p_color');
            if(savedColor) setTheme(savedColor);
        };

        function setTheme(color) {
            document.documentElement.style.setProperty('--main-color', color);
            document.documentElement.style.setProperty('--main-glow', color + '66');
            localStorage.setItem('p2p_color', color);
        }

        function toggleModal(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function clearData() {
            localStorage.clear();
            alert("Dados limpos! Recarregando...");
            location.reload();
        }

        function appendMessage(name, content, side, type = 'text') {
            const div = document.createElement('div');
            div.className = `msg-bubble p-3 rounded-2xl animate__animated animate__fadeInUp animate__faster mb-4 ${side === 'self' ? 'dynamic-bg self-end rounded-tr-none text-white' : 'bg-slate-800 self-start rounded-tl-none text-gray-200'} dynamic-border`;
            
            let inner = `<p class="text-[9px] font-black opacity-60 uppercase mb-1">${name || 'Sistema'}</p>`;
            
            if(type === 'text') inner += `<p class="text-sm leading-relaxed">${content}</p>`;
            else if(type === 'file') {
                const isImg = content.type.startsWith('image/');
                inner += isImg ? `<img src="${content.data}" class="rounded-lg mb-2 max-h-48">` : `<div class="bg-black/20 p-2 rounded mb-2 text-xs italic">üìÑ ${content.name}</div>`;
                inner += `<a href="${content.data}" download="${content.name}" class="text-[10px] bg-white/20 px-2 py-1 rounded block text-center">Baixar</a>`;
            }

            div.innerHTML = inner;
            msgContainer.appendChild(div);
            msgContainer.scrollTop = msgContainer.scrollHeight;
        }

        function initPeer(isHost) {
            myNick = document.getElementById('username').value.trim();
            const room = document.getElementById('room-name').value.trim().toLowerCase();
            roomPass = document.getElementById('room-pass').value.trim();

            if (!myNick || !room) return alert("Preencha Nick e Sala!");
            
            localStorage.setItem('p2p_nick', myNick);
            localStorage.setItem('p2p_room', room);
            localStorage.setItem('p2p_pass', roomPass);

            peer = new Peer(isHost ? room : undefined);

            peer.on('open', (id) => {
                document.getElementById('setup-screen').classList.add('hidden');
                document.getElementById('chat-screen').classList.replace('hidden', 'flex');
                document.getElementById('display-room').innerText = room;
                if (!isHost) handleConnection(peer.connect(room));
            });

            peer.on('connection', handleConnection);
        }

        function handleConnection(conn) {
            conn.on('open', () => {
                conn.send({ type: 'auth', pass: roomPass });
                conn.on('data', (data) => {
                    if(data.type === 'auth-fail') { alert("Senha incorreta!"); location.reload(); }
                    if(data.type === 'auth' && data.pass !== roomPass) { conn.send({type: 'auth-fail'}); conn.close(); }
                    if(data.type === 'chat') appendMessage(data.user, data.msg, "other");
                    if(data.type === 'file') appendMessage(data.user, data.file, "other", "file");
                });
                connections.push(conn);
            });
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            if (input.value.trim()) {
                const msg = input.value;
                connections.forEach(c => c.send({ type: 'chat', user: myNick, msg }));
                appendMessage("Voc√™", msg, "self");
                input.value = "";
            }
        }

        function sendFile(input) {
            const file = input.files[0];
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) return alert("M√°ximo 5MB!");

            const reader = new FileReader();
            reader.onload = () => {
                const fileData = { data: reader.result, name: file.name, type: file.type };
                connections.forEach(c => c.send({ type: 'file', user: myNick, file: fileData }));
                appendMessage("Voc√™", fileData, "self", "file");
            };
            reader.readAsDataURL(file);
        }

        document.getElementById('message-input').onkeypress = (e) => e.key === 'Enter' && sendMessage();
        document.getElementById('fullscreen-btn').onclick = () => {
            document.documentElement.requestFullscreen();
            document.getElementById('fullscreen-btn').style.display = 'none';
        };
    </script>
</body>
</html>
