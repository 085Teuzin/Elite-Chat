<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat P2P - Made By: @085_Teuzinnn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --orange-main: #f97316; }
        body { background-color: #0b0f1a; color: #e2e8f0; overflow: hidden; height: 100vh; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(249, 115, 22, 0.1); }
        .orange-glow-focus:focus { box-shadow: 0 0 15px rgba(249, 115, 22, 0.4); border-color: var(--orange-main); }
        .msg-shadow { box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.3); }
        #chat-messages::-webkit-scrollbar { width: 4px; }
        #chat-messages::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        #chat-messages::-webkit-scrollbar-thumb:hover { background: var(--orange-main); }
        .typing-dot { width: 4px; height: 4px; background: #94a3b8; border-radius: 50%; animation: blink 1.4s infinite; }
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body class="flex flex-col font-sans italic-none">

    <div class="flex justify-between items-center p-4 bg-slate-900/50 border-b border-orange-500/20">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-orange-500 animate-pulse"></div>
            <span class="font-black tracking-tighter text-orange-500 uppercase">P2P Secure Chat</span>
        </div>
        <button id="fullscreen-btn" class="bg-slate-800 hover:bg-orange-600 text-white w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 active:scale-90">ðŸ“º</button>
    </div>

    <main class="flex-grow flex flex-col items-center justify-center w-full max-w-lg mx-auto p-4 overflow-hidden relative">
        
        <div id="setup-screen" class="w-full space-y-5 glass p-8 rounded-3xl animate__animated animate__fadeInUp msg-shadow">
            <div class="text-center mb-6">
                <p class="text-gray-400 text-sm">ConexÃ£o direta e criptografada via WebRTC</p>
            </div>
            <div class="space-y-4">
                <div class="relative">
                    <input type="text" id="username" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 pl-12 focus:outline-none orange-glow-focus transition-all text-white" placeholder="Seu apelido">
                    <span class="absolute left-4 top-4 opacity-40">ðŸ‘¤</span>
                </div>
                <div class="relative">
                    <input type="text" id="room-name" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 pl-12 focus:outline-none orange-glow-focus transition-all text-white" placeholder="Nome da sala (ID)">
                    <span class="absolute left-4 top-4 opacity-40">ðŸ”‘</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 pt-4">
                <button onclick="initPeer(true)" class="bg-orange-600 hover:bg-orange-500 text-white font-black py-4 rounded-2xl transition-all shadow-lg shadow-orange-900/20 active:scale-95">CRIAR</button>
                <button onclick="initPeer(false)" class="bg-slate-800 hover:bg-slate-700 text-orange-500 font-black py-4 rounded-2xl border border-orange-500/30 transition-all active:scale-95">ENTRAR</button>
            </div>
        </div>

        <div id="chat-screen" class="hidden w-full flex-col h-full max-h-[85vh] glass rounded-3xl overflow-hidden animate__animated animate__zoomIn">
            <div class="bg-slate-800/80 p-4 border-b border-orange-500/20 flex justify-between items-center">
                <div>
                    <p id="display-room" class="font-bold text-orange-500 text-xs uppercase tracking-widest"></p>
                    <p id="peer-count" class="text-[10px] text-gray-500">Aguardando conexÃµes...</p>
                </div>
                <button onclick="clearChat()" class="text-[10px] bg-slate-700 px-2 py-1 rounded hover:bg-red-900 transition-colors">LIMPAR</button>
            </div>
            
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 flex flex-col scroll-smooth"></div>

            <div id="typing-indicator" class="px-4 py-1 text-[10px] text-gray-500 italic hidden">AlguÃ©m estÃ¡ digitando...</div>

            <div class="p-4 bg-slate-900/80 border-t border-slate-800">
                <div class="flex gap-2">
                    <input type="text" id="message-input" autocomplete="off" class="flex-grow bg-slate-950 border border-slate-800 rounded-2xl px-4 py-3 focus:outline-none focus:border-orange-500 transition-all text-sm" placeholder="Escreva aqui...">
                    <button onclick="sendMessage()" class="bg-orange-600 hover:bg-orange-500 w-12 h-12 rounded-2xl flex items-center justify-center transition-all active:scale-90 shadow-lg shadow-orange-900/40">
                        <svg viewBox="0 0 24 24" class="w-6 h-6 fill-white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center mt-5 text-gray-500 text-sm">
        Made By: <a href="https://instagram.com/085_Teuzinnn" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold transition duration-200">@085_Teuzinnn</a>
    </footer>

    <audio id="notif-sound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>

    <script>
        let peer = null;
        let connections = [];
        let myNick = "";
        const setupScreen = document.getElementById('setup-screen');
        const chatScreen = document.getElementById('chat-screen');
        const fsBtn = document.getElementById('fullscreen-btn');
        const messagesContainer = document.getElementById('chat-messages');
        const audio = document.getElementById('notif-sound');

        document.getElementById('username').value = localStorage.getItem('p2p_nick') || '';

        fsBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fsBtn.style.display = 'none';
            }
        });

        function appendMessage(name, text, side, system = false) {
            const div = document.createElement('div');
            if(system) {
                div.className = "self-center text-[10px] text-gray-600 uppercase tracking-tighter my-2";
                div.innerText = text;
            } else {
                div.className = `max-w-[85%] p-3 rounded-2xl animate__animated animate__fadeInUp animate__faster msg-shadow ${side === 'self' ? 'bg-gradient-to-br from-orange-500 to-orange-700 self-end rounded-tr-none text-white' : 'bg-slate-800 self-start rounded-tl-none text-gray-200'}`;
                div.innerHTML = `<p class="text-[9px] font-black opacity-60 uppercase mb-1">${name}</p><p class="text-sm leading-relaxed">${text}</p>`;
                if(side === 'other') audio.play().catch(()=>{});
            }
            messagesContainer.appendChild(div);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function initPeer(isHost) {
            myNick = document.getElementById('username').value.trim();
            const room = document.getElementById('room-name').value.trim().toLowerCase();

            if (!myNick || !room) return alert("Ei! Digite seu nick e o nome da sala.");
            localStorage.setItem('p2p_nick', myNick);

            peer = new Peer(isHost ? room : undefined, {
                debug: 1
            });

            peer.on('open', (id) => {
                setupScreen.classList.add('hidden');
                chatScreen.classList.remove('hidden');
                chatScreen.classList.add('flex');
                document.getElementById('display-room').innerText = `SALA: ${room}`;
                
                if (!isHost) {
                    const conn = peer.connect(room);
                    handleConnection(conn);
                }
                appendMessage(null, "ðŸ” ConexÃ£o ponta-a-ponta ativada", null, true);
            });

            peer.on('connection', (conn) => {
                handleConnection(conn);
                if(isHost) {
                    setTimeout(() => {
                        connections.forEach(c => {
                            if(c.peer !== conn.peer) c.send({type: 'system', msg: `${conn.metadata.nick} entrou no chat`});
                        });
                    }, 500);
                }
            });

            peer.on('error', (err) => {
                alert("Erro: Sala pode estar ocupada ou conexÃ£o falhou.");
                console.error(err);
            });
        }

        function handleConnection(conn) {
            conn.on('open', () => {
                conn.metadata = { nick: myNick };
                connections.push(conn);
                updatePeerCount();
                appendMessage(null, `Conectado a um par`, null, true);

                conn.on('data', (data) => {
                    if(data.type === 'chat') {
                        appendMessage(data.user, data.msg, "other");
                    } else if(data.type === 'system') {
                        appendMessage(null, data.msg, null, true);
                    }
                });

                conn.on('close', () => {
                    connections = connections.filter(c => c.peer !== conn.peer);
                    updatePeerCount();
                    appendMessage(null, "AlguÃ©m saiu do chat", null, true);
                });
            });
        }

        function updatePeerCount() {
            const count = connections.length;
            document.getElementById('peer-count').innerText = count === 0 ? "Aguardando amigos..." : `${count} amigo(s) conectado(s)`;
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const msg = input.value.trim();

            if (msg && connections.length > 0) {
                connections.forEach(conn => {
                    if(conn.open) conn.send({ type: 'chat', user: myNick, msg: msg });
                });
                appendMessage("VocÃª", msg, "self");
                input.value = "";
            } else if (connections.length === 0) {
                alert("NinguÃ©m na sala ainda!");
            }
        }

        function clearChat() {
            messagesContainer.innerHTML = "";
            appendMessage(null, "HistÃ³rico limpo localmente", null, true);
        }

        document.getElementById('message-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nome do app - Made By: @085_Teuzinnn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --orange-main: #f97316; }
        body { background-color: #0b0f1a; color: #e2e8f0; overflow: hidden; height: 100vh; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(249, 115, 22, 0.1); }
        .orange-glow-focus:focus { box-shadow: 0 0 15px rgba(249, 115, 22, 0.4); border-color: var(--orange-main); }
        .msg-shadow { box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.3); }
        #chat-messages::-webkit-scrollbar { width: 4px; }
        #chat-messages::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        #chat-messages::-webkit-scrollbar-thumb:hover { background: var(--orange-main); }
        .typing-dot { width: 4px; height: 4px; background: #94a3b8; border-radius: 50%; animation: blink 1.4s infinite; }
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body class="flex flex-col font-sans italic-none">

    <div class="flex justify-between items-center p-4 bg-slate-900/50 border-b border-orange-500/20">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-orange-500 animate-pulse"></div>
            <span class="font-black tracking-tighter text-orange-500 uppercase">P2P Secure Chat</span>
        </div>
        <button id="fullscreen-btn" class="bg-slate-800 hover:bg-orange-600 text-white w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 active:scale-90">ðŸ“º</button>
    </div>

    <main class="flex-grow flex flex-col items-center justify-center w-full max-w-lg mx-auto p-4 overflow-hidden relative">
        
        <div id="setup-screen" class="w-full space-y-5 glass p-8 rounded-3xl animate__animated animate__fadeInUp msg-shadow">
            <div class="text-center mb-6">
                <p class="text-gray-400 text-sm">ConexÃ£o direta e criptografada via WebRTC</p>
            </div>
            <div class="space-y-4">
                <div class="relative">
                    <input type="text" id="username" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 pl-12 focus:outline-none orange-glow-focus transition-all text-white" placeholder="Seu apelido">
                    <span class="absolute left-4 top-4 opacity-40">ðŸ‘¤</span>
                </div>
                <div class="relative">
                    <input type="text" id="room-name" class="w-full bg-slate-950/50 border border-slate-700 rounded-2xl p-4 pl-12 focus:outline-none orange-glow-focus transition-all text-white" placeholder="Nome da sala (ID)">
                    <span class="absolute left-4 top-4 opacity-40">ðŸ”‘</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 pt-4">
                <button onclick="initPeer(true)" class="bg-orange-600 hover:bg-orange-500 text-white font-black py-4 rounded-2xl transition-all shadow-lg shadow-orange-900/20 active:scale-95">CRIAR</button>
                <button onclick="initPeer(false)" class="bg-slate-800 hover:bg-slate-700 text-orange-500 font-black py-4 rounded-2xl border border-orange-500/30 transition-all active:scale-95">ENTRAR</button>
            </div>
        </div>

        <div id="chat-screen" class="hidden w-full flex-col h-full max-h-[85vh] glass rounded-3xl overflow-hidden animate__animated animate__zoomIn">
            <div class="bg-slate-800/80 p-4 border-b border-orange-500/20 flex justify-between items-center">
                <div>
                    <p id="display-room" class="font-bold text-orange-500 text-xs uppercase tracking-widest"></p>
                    <p id="peer-count" class="text-[10px] text-gray-500">Aguardando conexÃµes...</p>
                </div>
                <button onclick="clearChat()" class="text-[10px] bg-slate-700 px-2 py-1 rounded hover:bg-red-900 transition-colors">LIMPAR</button>
            </div>
            
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 flex flex-col scroll-smooth"></div>

            <div id="typing-indicator" class="px-4 py-1 text-[10px] text-gray-500 italic hidden">AlguÃ©m estÃ¡ digitando...</div>

            <div class="p-4 bg-slate-900/80 border-t border-slate-800">
                <div class="flex gap-2">
                    <input type="text" id="message-input" autocomplete="off" class="flex-grow bg-slate-950 border border-slate-800 rounded-2xl px-4 py-3 focus:outline-none focus:border-orange-500 transition-all text-sm" placeholder="Escreva aqui...">
                    <button onclick="sendMessage()" class="bg-orange-600 hover:bg-orange-500 w-12 h-12 rounded-2xl flex items-center justify-center transition-all active:scale-90 shadow-lg shadow-orange-900/40">
                        <svg viewBox="0 0 24 24" class="w-6 h-6 fill-white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center mt-5 text-gray-500 text-sm">
        Made By: <a href="https://instagram.com/085_Teuzinnn" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold transition duration-200">@085_Teuzinnn</a>
    </footer>

    <audio id="notif-sound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>

    <script>
        let peer = null;
        let connections = [];
        let myNick = "";
        const setupScreen = document.getElementById('setup-screen');
        const chatScreen = document.getElementById('chat-screen');
        const fsBtn = document.getElementById('fullscreen-btn');
        const messagesContainer = document.getElementById('chat-messages');
        const audio = document.getElementById('notif-sound');

        document.getElementById('username').value = localStorage.getItem('p2p_nick') || '';

        fsBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fsBtn.style.display = 'none';
            }
        });

        function appendMessage(name, text, side, system = false) {
            const div = document.createElement('div');
            if(system) {
                div.className = "self-center text-[10px] text-gray-600 uppercase tracking-tighter my-2";
                div.innerText = text;
            } else {
                div.className = `max-w-[85%] p-3 rounded-2xl animate__animated animate__fadeInUp animate__faster msg-shadow ${side === 'self' ? 'bg-gradient-to-br from-orange-500 to-orange-700 self-end rounded-tr-none text-white' : 'bg-slate-800 self-start rounded-tl-none text-gray-200'}`;
                div.innerHTML = `<p class="text-[9px] font-black opacity-60 uppercase mb-1">${name}</p><p class="text-sm leading-relaxed">${text}</p>`;
                if(side === 'other') audio.play().catch(()=>{});
            }
            messagesContainer.appendChild(div);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function initPeer(isHost) {
            myNick = document.getElementById('username').value.trim();
            const room = document.getElementById('room-name').value.trim().toLowerCase();

            if (!myNick || !room) return alert("Ei! Digite seu nick e o nome da sala.");
            localStorage.setItem('p2p_nick', myNick);

            peer = new Peer(isHost ? room : undefined, {
                debug: 1
            });

            peer.on('open', (id) => {
                setupScreen.classList.add('hidden');
                chatScreen.classList.remove('hidden');
                chatScreen.classList.add('flex');
                document.getElementById('display-room').innerText = `SALA: ${room}`;
                
                if (!isHost) {
                    const conn = peer.connect(room);
                    handleConnection(conn);
                }
                appendMessage(null, "ðŸ” ConexÃ£o ponta-a-ponta ativada", null, true);
            });

            peer.on('connection', (conn) => {
                handleConnection(conn);
                if(isHost) {
                    setTimeout(() => {
                        connections.forEach(c => {
                            if(c.peer !== conn.peer) c.send({type: 'system', msg: `${conn.metadata.nick} entrou no chat`});
                        });
                    }, 500);
                }
            });

            peer.on('error', (err) => {
                alert("Erro: Sala pode estar ocupada ou conexÃ£o falhou.");
                console.error(err);
            });
        }

        function handleConnection(conn) {
            conn.on('open', () => {
                conn.metadata = { nick: myNick };
                connections.push(conn);
                updatePeerCount();
                appendMessage(null, `Conectado a um par`, null, true);

                conn.on('data', (data) => {
                    if(data.type === 'chat') {
                        appendMessage(data.user, data.msg, "other");
                    } else if(data.type === 'system') {
                        appendMessage(null, data.msg, null, true);
                    }
                });

                conn.on('close', () => {
                    connections = connections.filter(c => c.peer !== conn.peer);
                    updatePeerCount();
                    appendMessage(null, "AlguÃ©m saiu do chat", null, true);
                });
            });
        }

        function updatePeerCount() {
            const count = connections.length;
            document.getElementById('peer-count').innerText = count === 0 ? "Aguardando amigos..." : `${count} amigo(s) conectado(s)`;
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const msg = input.value.trim();

            if (msg && connections.length > 0) {
                connections.forEach(conn => {
                    if(conn.open) conn.send({ type: 'chat', user: myNick, msg: msg });
                });
                appendMessage("VocÃª", msg, "self");
                input.value = "";
            } else if (connections.length === 0) {
                alert("NinguÃ©m na sala ainda!");
            }
        }

        function clearChat() {
            messagesContainer.innerHTML = "";
            appendMessage(null, "HistÃ³rico limpo localmente", null, true);
        }

        document.getElementById('message-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
